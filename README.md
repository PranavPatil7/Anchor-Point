# {{ project_name|title }}

Anchor Point â€“ Production Ready Django Project Template
data:image/png;base64,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

## Table of Contents

-  [Quick Docker Start](#quick-docker-start)
-  [Developer Workshop](#developer-workshop)
-  [Create a custom project](#create-a-custom-project)
-  [Start your server using Docker](#start-your-server-using-docker)
-  [Run the instance in development mode](#run-the-instance-in-development-mode)
-  [Run the instance on a public site](#run-the-instance-on-a-public-site)
-  [Stop the Docker Images](#stop-the-docker-images)
-  [Backup and Restore from Docker Images](#backup-and-restore-the-docker-images)
-  [Recommended: Track your changes](#recommended-track-your-changes)
-  [Hints: Configuring `requirements.txt`](#hints-configuring-requirementstxt)

## Quick Docker Start

  ```bash
    python3.10 -m venv ~/.venvs/project_name
    source ~/.venvs/{{ project_name }}/bin/activate

    pip install Django==4.2.9

    mkdir ~/project_name

    GN_VERSION=master # Define the branch or tag you want to generate the project from
    django-admin startproject --template=https://github.com/GeoNode/geonode-project/archive/refs/heads/$GN_VERSION.zip -e py,sh,md,rst,json,yml,ini,env,sample,properties -n monitoring-cron -n Dockerfile project_name ~/project_name

    cd ~/project_name
    python create-envfile.py 
  ```

The project can also be generated from a local checkout of the goenode-project repository

```bash
    git clone https://github.com/GeoNode/geonode-project
    git checkout $GN_VERSION
    django-admin startproject --template=./geonode-project -e py,sh,md,rst,json,yml,ini,env,sample,properties -n monitoring-cron -n Dockerfile project_name ~/project_name

  ```

`create-envfile.py` accepts the following arguments:

- `--https`: Enable SSL. It's disabled by default
- `--env_type`: 
   - When set to `prod` `DEBUG` is disabled and the creation of a valid `SSL` is requested to Letsencrypt's ACME server
   - When set to `test`  `DEBUG` is disabled and a test `SSL` certificate is generated for local testing
   - When set to `dev`  `DEBUG` is enabled and no `SSL` certificate is generated
- `--hostname`: The URL that whill serve GeoNode (`localhost` by default)
- `--email`: The administrator's email. Notice that a real email and a valid SMPT configurations are required if  `--env_type` is seto to `prod`. Letsencrypt uses to email for issuing the SSL certificate 
- `--geonodepwd`: GeoNode's administrator password. A random value is set if left empty
- `--geoserverpwd`: GeoNode's administrator password. A random value is set if left empty
- `--pgpwd`: PostgreSQL's administrator password. A random value is set if left empty
- `--dbpwd`: GeoNode DB user role's password. A random value is set if left empty
- `--geodbpwd`: GeoNode data DB user role's password. A random value is set if left empty
- `--clientid`: Client id of Geoserver's GeoNode Oauth2 client. A random value is set if left empty
- `--clientsecret`: Client secret of Geoserver's GeoNode Oauth2 client. A random value is set if left empty
```bash
  docker compose build
  docker compose up -d
```

## Developer Workshop

Available at

  ```bash
    http://geonode.org/dev-workshop
  ```

## Create a custom project

**NOTE**: *You can call your geonode project whatever you like **except 'geonode'**. Follow the naming conventions for python packages (generally lower case with underscores (``_``). In the examples below, replace ``{{ project_name }}`` with whatever you would like to name your project.*

To setup your project follow these instructions:

1. Generate the project

    ```bash
    git clone https://github.com/GeoNode/geonode-project.git -b <your_branch>
    source /usr/share/virtualenvwrapper/virtualenvwrapper.sh
    mkvirtualenv --python=/usr/bin/python3 {{ project_name }}
    pip install Django==3.2.16

    django-admin startproject --template=./geonode-project -e py,sh,md,rst,json,yml,ini,env,sample,properties -n monitoring-cron -n Dockerfile {{ project_name }}

    cd {{ project_name }}
    ```

2. Create the .env file

    An `.env` file is requird to run the application. It can be created from the `.env.sample` either manually or with the create-envfile.py script.

    The script accepts several parameters to create the file, in detail:

    - *hostname*: e.g. master.demo.geonode.org, default localhost
    - *https*: (boolean), default value is False
    - *email*: Admin email (this is required if https is set to True since a valid email is required by Letsencrypt certbot)
    - *env_type*: `prod`, `test` or `dev`. It will set the `DEBUG` variable to `False` (`prod`, `test`) or `True` (`dev`)
    - *geonodepwd*: GeoNode admin password (required inside the .env)
    - *geoserverpwd*: Geoserver admin password (required inside the .env)
    - *pgpwd*: PostgreSQL password (required inside the .env)
    - *dbpwd*: GeoNode DB user password (required inside the .env)
    - *geodbpwd*: Geodatabase user password (required inside the .env)
    - *clientid*: Oauth2 client id (required inside the .env)
    - *clientsecret*: Oauth2 client secret (required inside the .env)
    - *secret key*: Django secret key (required inside the .env)
    - *sample_file*: absolute path to a env_sample file used to create the env_file. If not provided, the one inside the GeoNode project is used.
    - *file*: absolute path to a json file that contains all the above configuration

     **NOTE:**
    - if the same configuration is passed in the json file and as an argument, the CLI one will overwrite the one in the JSON file
    - If some value is not provided, a random string is used

      Example USAGE

      ```bash
      python create-envfile.py -f /opt/core/geonode-project/file.json \
        --hostname localhost \
        --https \
        --email random@email.com \
        --geonodepwd gn_password \
        --geoserverpwd gs_password \
        --pgpwd pg_password \
        --dbpwd db_password \
        --geodbpwd _db_password \
        --clientid 12345 \
        --clientsecret abc123 
      ```

      Example JSON expected:

      ```JSON
      {
        "hostname": "value",
        "https": "value",
        "email": "value",
        "geonodepwd": "value",
        "geoserverpwd": "value",
        "pgpwd": "value",
        "dbpwd": "value",
        "geodbpwd": "value",
        "clientid": "value",
        "clientsecret": "value"
      } 
      ```

### Start your server using Docker

You need Docker 1.12 or higher, get the latest stable official release for your platform.
Once you have the project configured run the following command from the root folder of the project.

1. Run `docker-compose` to start it up (get a cup of coffee or tea while you wait)

    ```bash
    docker-compose build --no-cache
    docker-compose up -d
    ```

    ```bash
    set COMPOSE_CONVERT_WINDOWS_PATHS=1
    ```

    before running `docker-compose up`

2. Access the site on http://localhost/

## Run the instance in development mode

### Use dedicated docker-compose files while developing

**NOTE**: In this example we are going to keep localhost as the target IP for GeoNode

  ```bash
  docker-compose -f docker-compose.development.yml -f docker-compose.development.override.yml up
  ```

## Run the instance on a public site

### Preparation of the image (First time only)

**NOTE**: In this example we are going to publish to the public IP http://123.456.789.111

```bash
vim .env
  --> replace localhost with 123.456.789.111 everywhere
```

### Startup the image

```bash
docker-compose up --build -d
```

### Stop the Docker Images

```bash
docker-compose stop
```

### Fully Wipe-out the Docker Images

**WARNING**: This will wipe out all the repositories created until now.

**NOTE**: The images must be stopped first

```bash
docker system prune -a
```

## Backup and Restore from Docker Images

### Run a Backup

```bash
SOURCE_URL=$SOURCE_URL TARGET_URL=$TARGET_URL ./{{project_name}}/br/backup.sh $BKP_FOLDER_NAME
```

- BKP_FOLDER_NAME:
  Default value = backup_restore
  Shared Backup Folder name.
  The scripts assume it is located on "root" e.g.: /$BKP_FOLDER_NAME/

- SOURCE_URL:
  Source Server URL, the one generating the "backup" file.

- TARGET_URL:
  Target Server URL, the one which must be synched.

e.g.:

```bash
docker exec -it django4{{project_name}} sh -c 'SOURCE_URL=$SOURCE_URL TARGET_URL=$TARGET_URL ./{{project_name}}/br/backup.sh $BKP_FOLDER_NAME'
```

### Run a Restore

```bash
SOURCE_URL=$SOURCE_URL TARGET_URL=$TARGET_URL ./{{project_name}}/br/restore.sh $BKP_FOLDER_NAME
```

- BKP_FOLDER_NAME:
  Default value = backup_restore
  Shared Backup Folder name.
  The scripts assume it is located on "root" e.g.: /$BKP_FOLDER_NAME/

- SOURCE_URL:
  Source Server URL, the one generating the "backup" file.

- TARGET_URL:
  Target Server URL, the one which must be synched.

e.g.:

```bash
docker exec -it django4{{project_name}} sh -c 'SOURCE_URL=$SOURCE_URL TARGET_URL=$TARGET_URL ./{{project_name}}/br/restore.sh $BKP_FOLDER_NAME'
```

## Recommended: Track your changes

Step 1. Install Git (for Linux, Mac or Windows).

Step 2. Init git locally and do the first commit:

```bash
git init
git add *
git commit -m "Initial Commit"
```

Step 3. Set up a free account on github or bitbucket and make a copy of the repo there.

## Hints: Configuring `requirements.txt`

You may want to configure your requirements.txt, if you are using additional or custom versions of python packages. For example

```python
Django==3.2.16
git+git://github.com/<your organization>/geonode.git@<your branch>
```

## Increasing PostgreSQL Max connections

In case you need to increase the PostgreSQL Max Connections , you can modify
the **POSTGRESQL_MAX_CONNECTIONS** variable in **.env** file as below:

```
POSTGRESQL_MAX_CONNECTIONS=200
```

In this case PostgreSQL will run accepting 200 maximum connections.
